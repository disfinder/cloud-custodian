

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Authentication &amp; Access" href="authentication.html" />
    <link rel="prev" title="aws.workspaces resources" href="../aws/resources/workspaces.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aws/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/examples/index.html">Example Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws/resources/index.html">AWS Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-cloud-custodian-and-azure-plugin">Install Cloud Custodian and Azure Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#option-1-install-latest-from-the-repository">Option 1: Install latest from the repository</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#write-your-first-policy">Write your first policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-your-policy">Run your policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitor-azure">Monitor Azure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication &amp; Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/index.html">Azure Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gcp/gettingstarted.html">Getting Started (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/gcp-modes.html">GCP Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/contribute.html#adding-new-gcp-resources">Adding New GCP Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/contribute.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/resources/index.html">GCP Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="azure-gettingstarted"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#azure-install-cc"><span class="std std-ref">Install Cloud Custodian and Azure Plugin</span></a></p></li>
<li><p><a class="reference internal" href="#azure-write-policy"><span class="std std-ref">Write your first policy</span></a></p></li>
</ul>
<div class="section" id="install-cloud-custodian-and-azure-plugin">
<span id="azure-install-cc"></span><h2>Install Cloud Custodian and Azure Plugin<a class="headerlink" href="#install-cloud-custodian-and-azure-plugin" title="Permalink to this headline">¶</a></h2>
<p>Cloud Custodian is a Python application and supports Python 2 and 3 on Linux and Windows.
We recommend using Python 3.6 or higher.</p>
<p>The Azure provider is an additional package which is installed in addition to c7n.</p>
<div class="section" id="option-1-install-latest-from-the-repository">
<h3>Option 1: Install latest from the repository<a class="headerlink" href="#option-1-install-latest-from-the-repository" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/cloud-custodian/cloud-custodian.git
$ <span class="nb">cd</span> cloud-custodian
$ pip install -e .
$ pip install -e tools/c7n_azure
</pre></div>
</div>
</div>
</div>
<div class="section" id="write-your-first-policy">
<span id="azure-write-policy"></span><h2>Write your first policy<a class="headerlink" href="#write-your-first-policy" title="Permalink to this headline">¶</a></h2>
<p>A policy specifies the following items:</p>
<ul class="simple">
<li><p>The type of resource to run the policy against</p></li>
<li><p>Filters to narrow down the set of resources</p></li>
<li><p>Actions to take on the filtered set of resources</p></li>
</ul>
<p>For this tutorial we will filter to a VM of a specific name, then add the tag <code class="docutils literal notranslate"><span class="pre">Hello:</span> <span class="pre">World</span></code>.</p>
<p>Create a file named <code class="docutils literal notranslate"><span class="pre">custodian.yml</span></code> with this content, and update <code class="docutils literal notranslate"><span class="pre">my_vm_name</span></code> to match an existing VM.</p>
<p><em>note: Some text editors (VSCode) inject invalid whitespace characters when copy/pasting YAML from a browser</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy</span>
      <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">Adds a tag to a virtual machines</span>
      <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">azure.vm</span>
      <span class="nt">filters</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
          <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_vm_name</span>
      <span class="nt">actions</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tag</span>
         <span class="nt">tag</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hello</span>
         <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">World</span>
</pre></div>
</div>
</div>
<div class="section" id="run-your-policy">
<span id="azure-run-policy"></span><h2>Run your policy<a class="headerlink" href="#run-your-policy" title="Permalink to this headline">¶</a></h2>
<p>First, <strong>choose one of the supported authentication mechanisms</strong> and either log in to Azure CLI or set
environment variables as documented in <a class="reference internal" href="authentication.html#azure-authentication"><span class="std std-ref">Authentication &amp; Access</span></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>custodian run --output-dir<span class="o">=</span>. custodian.yml
</pre></div>
</div>
<p>If successful, you should see output similar to the following on the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">06</span><span class="p">,</span><span class="mi">133</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">Running</span> <span class="n">policy</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span> <span class="n">azure</span><span class="o">.</span><span class="n">vm</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">07</span><span class="p">,</span><span class="mi">514</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">resource</span><span class="p">:</span><span class="n">ec2</span> <span class="n">has</span> <span class="n">count</span><span class="p">:</span><span class="mi">1</span> <span class="n">time</span><span class="p">:</span><span class="mf">1.38</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span><span class="mi">188</span><span class="p">:</span> <span class="n">custodian</span><span class="o">.</span><span class="n">policy</span><span class="p">:</span><span class="n">INFO</span> <span class="n">policy</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">policy</span> <span class="n">action</span><span class="p">:</span> <span class="n">tag</span><span class="p">:</span> <span class="mi">1</span> <span class="n">execution_time</span><span class="p">:</span> <span class="mf">0.67</span>
</pre></div>
</div>
<p>You should also find a new <code class="docutils literal notranslate"><span class="pre">my-first-policy</span></code> directory with a log and a <code class="docutils literal notranslate"><span class="pre">resources.json</span></code>.  The <code class="docutils literal notranslate"><span class="pre">resources.json</span></code>
file shows you the raw data that results from your policy after filtering is applied.  This file can help you understand the
fields available for your resources while developing your policy.</p>
<p>See <a class="reference internal" href="../filters.html#filters"><span class="std std-ref">Generic Filters</span></a> for more information on the features of the Value filter used in this sample.</p>
</div>
<div class="section" id="monitor-azure">
<span id="monitor-azure-cc"></span><h2>Monitor Azure<a class="headerlink" href="#monitor-azure" title="Permalink to this headline">¶</a></h2>
<p>You can generate App Insights metrics by specifying the <code class="docutils literal notranslate"><span class="pre">--metrics</span></code> flag and specifying <code class="docutils literal notranslate"><span class="pre">azure</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s &lt;output_directory&gt; --metrics azure &lt;policyfile&gt;.yml
</pre></div>
</div>
<p>You can also upload Cloud Custodian logs to App Insights logs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run --log-group=azure://cloud-custodian/&lt;dev-account&gt;/&lt;region&gt; -s &lt;output_directory&gt; &lt;policyfile&gt;.yml
</pre></div>
</div>
<p>And you can output logs and resource records to Azure storage accounts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ custodian run -s azure://&lt;my-bucket&gt;&lt;my-prefix&gt; &lt;policyfile&gt;.yml
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="authentication.html" class="btn btn-neutral float-right" title="Authentication &amp; Access" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../aws/resources/workspaces.html" class="btn btn-neutral float-left" title="aws.workspaces resources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>