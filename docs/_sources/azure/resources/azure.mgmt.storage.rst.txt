azure.azure.mgmt.storage resources
##################################




.. _azure.storage:

azure.storage
=============

Storage Account Resource

:example:

Finds all Storage Accounts in the subscription.

.. code-block:: yaml

    policies:
        - name: find-all-storage-accounts
          resource: azure.storage

Filters
-------


  - :ref:`event <azure.common.filters.event>`
  
  - :ref:`firewall-rules <azure.common.filters.firewall-rules>`
  
  - :ref:`marked-for-op <azure.common.filters.marked-for-op>`
  
  - :ref:`metric <azure.common.filters.metric>`
  
  - :ref:`policy-compliant <azure.common.filters.policy-compliant>`
  
  - :ref:`resource-lock <azure.common.filters.resource-lock>`
  
  - :ref:`storage-diagnostic-settings <azure.common.filters.storage-diagnostic-settings>`
  
  - :ref:`value <azure.common.filters.value>`
  




Actions
-------


  - :ref:`auto-tag-user <azure.common.actions.auto-tag-user>`
  
  - :ref:`delete <azure.common.actions.delete>`
  
  - :ref:`lock <azure.common.actions.lock>`
  
  - :ref:`logic-app <azure.common.actions.logic-app>`
  
  - :ref:`mark-for-op <azure.common.actions.mark-for-op>`
  
  - :ref:`notify <azure.common.actions.notify>`
  
  - :ref:`set-network-rules <azure.storage.actions.set-network-rules>`

  - :ref:`tag <azure.common.actions.tag>`
  
  - :ref:`tag-trim <azure.common.actions.tag-trim>`
  
  - :ref:`untag <azure.common.actions.untag>`
  
  - :ref:`webhook <azure.common.actions.webhook>`
  



.. _azure.storage.actions.set-network-rules:

set-network-rules
+++++++++++++++++
Set Network Rules Action

Updates Azure Storage Firewalls and Virtual Networks settings.

:example:

Find storage accounts without any firewall rules.

Configure default-action to ``Deny`` and then allow:
- Azure Logging and Metrics services
- Two specific IPs
- Two subnets

.. code-block:: yaml

    policies:
        - name: add-storage-firewall
          resource: azure.storage

        filters:
            - type: value
              key: properties.networkAcls.ipRules
              value_type: size
              op: eq
              value: 0

        actions:
            - type: set-network-rules
              default-action: Deny
              bypass: [Logging, Metrics]
              ip-rules:
                  - ip-address-or-range: 11.12.13.14
                  - ip-address-or-range: 21.22.23.24
              virtual-network-rules:
                  - virtual-network-resource-id: <subnet_resource_id>
                  - virtual-network-resource-id: <subnet_resource_id>

.. container:: toggle

  

  .. raw:: html
    ‚Åü
    <div class="header docutils container" style=""></div>

  .. code-block:: yaml

    properties:
      bypass:
        items:
          enum:
          - AzureServices
          - Logging
          - Metrics
        type: array
      default-action:
        enum:
        - Allow
        - Deny
      ip-rules:
        items:
          ip-address-or-range:
            type: string
        type: array
      type:
        enum:
        - set-network-rules
      virtual-network-rules:
        items:
          virtual-network-resource-id:
            type: string
        type: array
    required:
    - default-action
    - type


