

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example offhours policy &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RDS - Delete Unused Databases With No Connections" href="rdsdeleteunused.html" />
    <link rel="prev" title="Lambda - Notify On Lambda Errors" href="lambdaerrorsnotify.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example Policies</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="accountinvalidiplogin.html">Account - Login From Invalid IP Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountrootlogin.html">Account - Detect Root Logins</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountservicelimit.html">Account - Service Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="amicomp.html">AMI - Stop EC2 using Unapproved AMIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="asginvalidconfig.html">AutoScaling Group - Verify ASGs have valid configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="asgoffhours.html">ASG - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="blocknonstandardregionresources.html">Block New Resources In Non-Standard Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dmsenforcessl.html">DMS - DB Migration Service Endpoint - Enforce SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsgarbagecollect.html">EBS - Garbage Collect Unattached Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebssnapshots.html">EBS - Create and Manage Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsunencrypted.html">EBS - Delete Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2-auto-tag-user.html">EC2 - auto-tag aws userName on resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2offhours.html">EC2 - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2oldinstances.html">EC2 - Old Instance Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2poweronstoppedforpatching.html">EC2 - Power On For Scheduled Patching</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2unpatchedworkflow.html">EC2 - Terminate Unpatchable Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbdeleteinetfacing.html">ELB - Delete New Internet-Facing ELBs</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbgarbagecollection.html">ELB - Delete Unused Elastic Load Balancers</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslblacklist.html">ELB - SSL Blacklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslwhitelist.html">ELB - SSL Whitelist</a></li>
<li class="toctree-l2"><a class="reference internal" href="iamsetrolepolicy.html">IAM - Manage Whether A Specific IAM Policy is Attached to Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambdaerrorsnotify.html">Lambda - Notify On Lambda Errors</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example offhours policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#resource-scheduling-offhours">Resource Scheduling Offhours</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#policy-configuration">Policy Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tag-based-configuration">Tag Based Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scheduleparser-time-specifications">ScheduleParser Time Specifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#policy-examples">Policy examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resume-during-offhours">Resume During Offhours</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elasticbeanstalk-efs-and-other-services-with-tag-value-restrictions">ElasticBeanstalk, EFS and Other Services with Tag Value Restrictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#public-holidays">Public Holidays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rdsdeleteunused.html">RDS - Delete Unused Databases With No Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdspublicunencrypted.html">RDS - Terminate Unencrypted Public Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3configurenewbucket.html">S3 - Configure New Buckets Settings and Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3denypublicobjectacls.html">S3 - Block Public S3 Object ACLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3encryption.html">S3 - Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3globalgrants.html">S3 - Global Grants</a></li>
<li class="toctree-l2"><a class="reference internal" href="sagemakernotebookdeletepublicorunencrypted.html">SageMaker Notebook - Delete Public or Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="securitygroupsdetectremediate.html">Security Groups - Detect and Remediate Violations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tagcompliance.html">Tag Compliance Across Resources (EC2, ASG, ELB, S3, etc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcflowlog.html">VPC - Flow Log Configuration Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcpeeringcrossaccount.html">VPC - Notify On Invalid External Peering Connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">AWS Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/authentication.html">Authentication &amp; Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/policy/index.html">Supported Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/resources/index.html">Azure Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gettingstarted.html">Getting Started (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gcp-modes.html">GCP Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#adding-new-gcp-resources">Adding New GCP Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/resources/index.html">GCP Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Example Policies</a> &raquo;</li>
        
      <li>Example offhours policy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-c7n.filters.offhours">
<span id="example-offhours-policy"></span><span id="offhours"></span><h1>Example offhours policy<a class="headerlink" href="#module-c7n.filters.offhours" title="Permalink to this headline">¶</a></h1>
<div class="section" id="resource-scheduling-offhours">
<h2>Resource Scheduling Offhours<a class="headerlink" href="#resource-scheduling-offhours" title="Permalink to this headline">¶</a></h2>
<p>Custodian provides for time based filters, that allow for taking periodic
action on a resource, with resource schedule customization based on tag values.
A common use is offhours scheduling for asgs and instances.</p>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Flexible offhours scheduling with opt-in, opt-out selection, and timezone
support.</p></li>
<li><p>Resume during offhours support.</p></li>
<li><p>Can be combined with other filters to get a particular set (
resources with tag, vpc, etc).</p></li>
<li><p>Can be combined with arbitrary actions</p></li>
<li><p>Can omit a set of dates such as public holidays.</p></li>
</ul>
</div>
<div class="section" id="policy-configuration">
<h2>Policy Configuration<a class="headerlink" href="#policy-configuration" title="Permalink to this headline">¶</a></h2>
<p>We provide an <cite>onhour</cite> and <cite>offhour</cite> time filter, each should be used in a
different policy, they support the same configuration options:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>weekends</strong>: default true, whether to leave resources off for the weekend</p></li>
<li><p><strong>weekend-only</strong>: default false, whether to turn the resource off only on
the weekend</p></li>
<li><p><strong>default_tz</strong>: which timezone to utilize when evaluating time <strong>(REQUIRED)</strong></p></li>
<li><p><strong>tag</strong>: which resource tag name to use for per-resource configuration
(schedule and timezone overrides and opt-in/opt-out); default is
<code class="docutils literal notranslate"><span class="pre">maid_offhours</span></code>.</p></li>
<li><p><strong>opt-out</strong>: Determines the behavior for resources which do not have a tag
matching the one specified for <strong>tag</strong>. Values can be either <code class="docutils literal notranslate"><span class="pre">false</span></code> (the
default) where the policy operates on an opt-in basis and resources must have
the tag in order to be acted on by the policy, or <code class="docutils literal notranslate"><span class="pre">true</span></code> where the policy
operates on an opt-out basis, and resources without the tag are acted on by
the policy.</p></li>
<li><p><strong>onhour</strong>: the default time to start/run resources, specified as 0-23</p></li>
<li><p><strong>offhour</strong>: the default time to stop/suspend resources, specified as 0-23</p></li>
<li><p><strong>skip-days</strong>: a list of dates to skip. Dates must use format YYYY-MM-DD</p></li>
<li><p><strong>skip-days-from</strong>: a list of dates to skip stored at a url. <strong>expr</strong>,
<strong>format</strong>, and <strong>url</strong> must be passed as parameters. Same syntax as
<code class="docutils literal notranslate"><span class="pre">value_from</span></code>. Can not specify both <strong>skip-days-from</strong> and <strong>skip-days</strong>.</p></li>
</ul>
</div></blockquote>
<p>This example policy overrides most of the defaults for an offhour policy:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-stop</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="nt">filters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
        <span class="nt">weekends</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="nt">default_tz</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pt</span>
        <span class="nt">tag</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">downtime</span>
        <span class="nt">opt-out</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">onhour</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
        <span class="nt">offhour</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
</pre></div>
</div>
</div>
<div class="section" id="tag-based-configuration">
<h2>Tag Based Configuration<a class="headerlink" href="#tag-based-configuration" title="Permalink to this headline">¶</a></h2>
<p>Resources can use a special tag to override the default configuration on a
per-resource basis. Note that the name of the tag is configurable via the
<code class="docutils literal notranslate"><span class="pre">tag</span></code> option in the policy; the examples below use the default tag name,
<code class="docutils literal notranslate"><span class="pre">maid_offhours</span></code>.</p>
<p>The value of the tag must be one of the following:</p>
<ul class="simple">
<li><p><strong>(empty)</strong> or <strong>on</strong> - An empty tag value or a value of “on” implies night
and weekend offhours using the default time zone configured in the policy
(tz=est if unspecified) and the default onhour and offhour values configured
in the policy.</p></li>
<li><p><strong>off</strong> - If offhours is configured to run in opt-out mode, this tag can be
specified to disable offhours on a given instance. If offhours is configured
to run in opt-in mode, this tag will have no effect (the resource will still
be opted out).</p></li>
<li><p>a semicolon-separated string composed of one or more of the following
components, which override the defaults specified in the policy:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tz=&lt;timezone&gt;</span></code> to evaluate with a resource-specific timezone, where
<code class="docutils literal notranslate"><span class="pre">&lt;timezone&gt;</span></code> is either one of the supported timezone aliases defined in
<code class="xref py py-attr docutils literal notranslate"><span class="pre">c7n.filters.offhours.Time.TZ_ALIASES</span></code> (such as <code class="docutils literal notranslate"><span class="pre">pt</span></code>) or the name
of a geographic timezone identifier in
[IANA’s tzinfo database](<a class="reference external" href="https://www.iana.org/time-zones">https://www.iana.org/time-zones</a>), such as
<code class="docutils literal notranslate"><span class="pre">Americas/Los_Angeles</span></code>. <em>(Note all timezone aliases are
referenced to a locality to ensure taking into account local daylight
savings time, if applicable.)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off=(time</span> <span class="pre">spec)</span></code> and/or <code class="docutils literal notranslate"><span class="pre">on=(time</span> <span class="pre">spec)</span></code> matching time specifications
supported by <code class="xref py py-class docutils literal notranslate"><span class="pre">c7n.filters.offhours.ScheduleParser</span></code> as described
in the next section.</p></li>
</ul>
</li>
</ul>
<div class="section" id="scheduleparser-time-specifications">
<h3>ScheduleParser Time Specifications<a class="headerlink" href="#scheduleparser-time-specifications" title="Permalink to this headline">¶</a></h3>
<p>Each time specification follows the format <code class="docutils literal notranslate"><span class="pre">(days,hours)</span></code>. Multiple time
specifications can be combined in square-bracketed lists, i.e.
<code class="docutils literal notranslate"><span class="pre">[(days,hours),(days,hours),(days,hours)]</span></code>.</p>
<p><strong>Examples</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># up mon-fri from 7am-7pm; eastern time</span>
<span class="n">off</span><span class="o">=</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">F</span><span class="p">,</span><span class="mi">19</span><span class="p">);</span><span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">F</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># up mon-fri from 6am-9pm; up sun from 10am-6pm; pacific time</span>
<span class="n">off</span><span class="o">=</span><span class="p">[(</span><span class="n">M</span><span class="o">-</span><span class="n">F</span><span class="p">,</span><span class="mi">21</span><span class="p">),(</span><span class="n">U</span><span class="p">,</span><span class="mi">18</span><span class="p">)];</span><span class="n">on</span><span class="o">=</span><span class="p">[(</span><span class="n">M</span><span class="o">-</span><span class="n">F</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="n">U</span><span class="p">,</span><span class="mi">10</span><span class="p">)];</span><span class="n">tz</span><span class="o">=</span><span class="n">pt</span>
</pre></div>
</div>
<p><strong>Possible values</strong>:</p>
<blockquote>
<div><table class="docutils align-center">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>field</p></th>
<th class="head"><p>values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>days</p></td>
<td><p>M, T, W, H, F, S, U</p></td>
</tr>
<tr class="row-odd"><td><p>hours</p></td>
<td><p>0, 1, 2, …, 22, 23</p></td>
</tr>
</tbody>
</table>
<p>Days can be specified in a range (ex. M-F).</p>
</div></blockquote>
</div>
</div>
<div class="section" id="policy-examples">
<h2>Policy examples<a class="headerlink" href="#policy-examples" title="Permalink to this headline">¶</a></h2>
<p>Turn ec2 instances on and off</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-stop</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="nt">filters</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">offhours-start</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class="nt">filters</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">onhour</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
</pre></div>
</div>
<p>Here’s doing the same with auto scale groups</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">asg-offhours-stop</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">asg</span>
    <span class="nt">filters</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">offhour</span>
    <span class="nt">actions</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">suspend</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">asg-onhours-start</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">asg</span>
    <span class="nt">filters</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">onhour</span>
    <span class="nt">actions</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">resume</span>
</pre></div>
</div>
<p>Additional policy examples and resource-type-specific information can be seen in
the <a class="reference internal" href="ec2offhours.html#ec2offhours"><span class="std std-ref">EC2 Offhours</span></a> and <a class="reference internal" href="asgoffhours.html#asgoffhours"><span class="std std-ref">ASG Offhours</span></a>
use cases.</p>
</div>
<div class="section" id="resume-during-offhours">
<h2>Resume During Offhours<a class="headerlink" href="#resume-during-offhours" title="Permalink to this headline">¶</a></h2>
<p>These policies are evaluated hourly; during each run (once an hour),
cloud-custodian will act on <strong>only</strong> the resources tagged for that <strong>exact</strong>
hour. In other words, if a resource has an offhours policy of
stopping/suspending at 23:00 Eastern daily and starting/resuming at 06:00
Eastern daily, and you run cloud-custodian once an hour via Lambda, that
resource will only be stopped once a day sometime between 23:00 and 23:59, and
will only be started once a day sometime between 06:00 and 06:59. If the current
hour does not <em>exactly</em> match the hour specified in the policy, nothing will be
done at all.</p>
<p>As a result of this, if custodian stops an instance or suspends an ASG and you
need to start/resume it, you can safely do so manually and custodian won’t touch
it again until the next day.</p>
</div>
<div class="section" id="elasticbeanstalk-efs-and-other-services-with-tag-value-restrictions">
<h2>ElasticBeanstalk, EFS and Other Services with Tag Value Restrictions<a class="headerlink" href="#elasticbeanstalk-efs-and-other-services-with-tag-value-restrictions" title="Permalink to this headline">¶</a></h2>
<p>A number of AWS services have restrictions on the characters that can be used
in tag values, such as <a class="reference external" href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features.tagging.html">ElasticBeanstalk</a> and <a class="reference external" href="http://docs.aws.amazon.com/efs/latest/ug/API_Tag.html">EFS</a>. In particular, these services do not allow
parenthesis, square brackets, commas, or semicolons, or empty tag values. This
proves to be problematic with the tag-based schedule configuration described
above. The best current workaround is to define a separate policy with a unique
<code class="docutils literal notranslate"><span class="pre">tag</span></code> name for each unique schedule that you want to use, and then tag
resources with that tag name and a value of <code class="docutils literal notranslate"><span class="pre">on</span></code>. Note that this can only be
used in opt-in mode, not opt-out.</p>
</div>
<div class="section" id="public-holidays">
<h2>Public Holidays<a class="headerlink" href="#public-holidays" title="Permalink to this headline">¶</a></h2>
<p>In order to properly implement support for public holidays, make sure to include
either <strong>skip-days</strong> or <strong>skip-days-from</strong> with your policy. This list
should contain all of the public holidays you wish to address and must use
YYYY-MM-DD syntax for its dates. If the date the policy is being run on matches
any one of those dates, the policy will not return any resources. These dates
include year as many holidays vary from year to year so year is required to prevent
errors. A sample policy that would not start stopped instances on a public holiday
might look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">onhour-morning-start-skip-holidays</span>
      <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
      <span class="nt">filters</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">onhour</span>
          <span class="nt">tag</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">custodian_downtime</span>
          <span class="nt">default_tz</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">et</span>
          <span class="nt">onhour</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
          <span class="nt">skip-days</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;2017-12-25&#39;</span><span class="p p-Indicator">]</span>
      <span class="nt">actions</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rdsdeleteunused.html" class="btn btn-neutral float-right" title="RDS - Delete Unused Databases With No Connections" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lambdaerrorsnotify.html" class="btn btn-neutral float-left" title="Lambda - Notify On Lambda Errors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>