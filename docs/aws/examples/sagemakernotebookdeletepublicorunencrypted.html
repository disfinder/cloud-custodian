

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SageMaker Notebook - Delete Public or Unencrypted &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Security Groups - Detect and Remediate Violations" href="securitygroupsdetectremediate.html" />
    <link rel="prev" title="S3 - Global Grants" href="s3globalgrants.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example Policies</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="accountinvalidiplogin.html">Account - Login From Invalid IP Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountrootlogin.html">Account - Detect Root Logins</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountservicelimit.html">Account - Service Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="amicomp.html">AMI - Stop EC2 using Unapproved AMIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="asginvalidconfig.html">AutoScaling Group - Verify ASGs have valid configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="asgoffhours.html">ASG - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="blocknonstandardregionresources.html">Block New Resources In Non-Standard Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dmsenforcessl.html">DMS - DB Migration Service Endpoint - Enforce SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsgarbagecollect.html">EBS - Garbage Collect Unattached Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebssnapshots.html">EBS - Create and Manage Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsunencrypted.html">EBS - Delete Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2-auto-tag-user.html">EC2 - auto-tag aws userName on resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2offhours.html">EC2 - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2oldinstances.html">EC2 - Old Instance Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2poweronstoppedforpatching.html">EC2 - Power On For Scheduled Patching</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2unpatchedworkflow.html">EC2 - Terminate Unpatchable Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbdeleteinetfacing.html">ELB - Delete New Internet-Facing ELBs</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbgarbagecollection.html">ELB - Delete Unused Elastic Load Balancers</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslblacklist.html">ELB - SSL Blacklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslwhitelist.html">ELB - SSL Whitelist</a></li>
<li class="toctree-l2"><a class="reference internal" href="iamsetrolepolicy.html">IAM - Manage Whether A Specific IAM Policy is Attached to Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambdaerrorsnotify.html">Lambda - Notify On Lambda Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="offhours.html">Example offhours policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdsdeleteunused.html">RDS - Delete Unused Databases With No Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdspublicunencrypted.html">RDS - Terminate Unencrypted Public Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3configurenewbucket.html">S3 - Configure New Buckets Settings and Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3denypublicobjectacls.html">S3 - Block Public S3 Object ACLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3encryption.html">S3 - Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3globalgrants.html">S3 - Global Grants</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SageMaker Notebook - Delete Public or Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="securitygroupsdetectremediate.html">Security Groups - Detect and Remediate Violations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tagcompliance.html">Tag Compliance Across Resources (EC2, ASG, ELB, S3, etc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcflowlog.html">VPC - Flow Log Configuration Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcpeeringcrossaccount.html">VPC - Notify On Invalid External Peering Connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">AWS Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/authentication.html">Authentication &amp; Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/resources/index.html">Azure Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gettingstarted.html">Getting Started (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gcp-modes.html">GCP Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#adding-new-gcp-resources">Adding New GCP Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/resources/index.html">GCP Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Example Policies</a> &raquo;</li>
        
      <li>SageMaker Notebook - Delete Public or Unencrypted</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sagemaker-notebook-delete-public-or-unencrypted">
<span id="sagemakernotebookdeletepublicorunencrypted"></span><h1>SageMaker Notebook - Delete Public or Unencrypted<a class="headerlink" href="#sagemaker-notebook-delete-public-or-unencrypted" title="Permalink to this headline">¶</a></h1>
<p>The following example policy chain will detect if new SageMaker Notebooks are internet-facing
(public) or unencrypted (not using KMS) at launch and then tag, stop, and delete the notebook
and email the customer and cloud custodian admin.  SageMaker Notebooks cannot be deleted unless they
are in a Stopped status and they cannot be stopped until they are in a InService status which
is why this needs a chain of policies that will trigger in order using tags and scheduled Lambda
runs.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>


<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook-auto-tag-user</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">When a new Sagemaker notebook is created tag the creators ID to CreatorName tag</span>
  <span class="nt">mode</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class="nt">events</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker.amazonaws.com</span>
          <span class="nt">event</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CreateNotebookInstance</span>
          <span class="nt">ids</span><span class="p">:</span> <span class="s">&quot;responseElements.notebookInstanceArn&quot;</span>
  <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auto-tag-user</span>
      <span class="nt">tag</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CreatorName</span>



<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook-tag-non-compliant</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">When a new Sagemaker Notebook is created that is public or not encrypted</span>
    <span class="no">it will get tagged for stopping and then deletion</span>
  <span class="nt">mode</span><span class="p">:</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class="nt">events</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker.amazonaws.com</span>
          <span class="nt">event</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CreateNotebookInstance</span>
          <span class="nt">ids</span><span class="p">:</span> <span class="s">&quot;responseElements.notebookInstanceArn&quot;</span>
  <span class="nt">filters</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">or</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;DirectInternetAccess&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;Enabled&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;KmsKeyId&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
  <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tag</span>
      <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NonCompliantTag</span>
      <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;TRUE&quot;</span>



<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook-stop-non-compliant</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">If a SageMaker Notebook is tagged with NonCompliantTag then it gets stopped and tagged</span>
    <span class="no">with NonCompliantTagStopped for deletion</span>
  <span class="nt">mode</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
    <span class="nt">schedule</span><span class="p">:</span> <span class="s">&quot;rate(5</span><span class="nv"> </span><span class="s">minutes)&quot;</span>
    <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">45</span>
  <span class="nt">filters</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;tag:NonCompliantTag&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;TRUE&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;NotebookInstanceStatus&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;InService&quot;</span>
  <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tag</span>
      <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NonCompliantTagStopped</span>
      <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;TRUE&quot;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>



<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook-delete-non-compliant</span>
  <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sagemaker-notebook</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">When a new Sagemaker notebook is tagged as non-compliant and in a stopped state, delete it</span>
  <span class="nt">mode</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
    <span class="nt">schedule</span><span class="p">:</span> <span class="s">&quot;rate(5</span><span class="nv"> </span><span class="s">minutes)&quot;</span>
    <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">45</span>
  <span class="nt">filters</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;tag:NonCompliantTagStopped&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;TRUE&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;NotebookInstanceStatus&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;Stopped&quot;</span>
  <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">delete</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">notify</span>
      <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default.html</span>
      <span class="nt">priority_header</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">subject</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SageMaker Notebook - Deleted! - [custodian {{ account }} - {{ region }}]</span>
      <span class="nt">violation_desc</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">Public facing (Non-VPC) OR Non-Encrypted Sagemaker Notebooks Are Prohibited!</span>
          <span class="no">All Notebooks Must Be in VPC mode and encrypted!</span>
      <span class="nt">action_desc</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">Actions Taken:  Your SageMaker Notebook Instance has been deleted due to being non-compliant.  Please create a new</span>
          <span class="no">SageMaker notebook in VPC mode with KMS encryption enabled.</span>
      <span class="nt">to</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CloudCustodian@Company.com</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">resource-owner</span>
      <span class="nt">transport</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sqs</span>
        <span class="nt">queue</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://sqs.us-east-1.amazonaws.com/123456789123/cloud-custodian-mailer</span>
        <span class="nt">region</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="securitygroupsdetectremediate.html" class="btn btn-neutral float-right" title="Security Groups - Detect and Remediate Violations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="s3globalgrants.html" class="btn btn-neutral float-left" title="S3 - Global Grants" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>