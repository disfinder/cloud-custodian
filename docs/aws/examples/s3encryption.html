

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>S3 - Encryption &mdash; Cloud Custodian  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/js/expand.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/expand.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="S3 - Global Grants" href="s3globalgrants.html" />
    <link rel="prev" title="S3 - Block Public S3 Object ACLs" href="s3denypublicobjectacls.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html">Generic Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../actions.html">Generic Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/policyStructure.html">Example tag compliance policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">AWS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example Policies</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="accountinvalidiplogin.html">Account - Login From Invalid IP Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountrootlogin.html">Account - Detect Root Logins</a></li>
<li class="toctree-l2"><a class="reference internal" href="accountservicelimit.html">Account - Service Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="amicomp.html">AMI - Stop EC2 using Unapproved AMIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="asginvalidconfig.html">AutoScaling Group - Verify ASGs have valid configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="asgoffhours.html">ASG - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="blocknonstandardregionresources.html">Block New Resources In Non-Standard Regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dmsenforcessl.html">DMS - DB Migration Service Endpoint - Enforce SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsgarbagecollect.html">EBS - Garbage Collect Unattached Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebssnapshots.html">EBS - Create and Manage Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="ebsunencrypted.html">EBS - Delete Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2-auto-tag-user.html">EC2 - auto-tag aws userName on resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2offhours.html">EC2 - Offhours Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2oldinstances.html">EC2 - Old Instance Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2poweronstoppedforpatching.html">EC2 - Power On For Scheduled Patching</a></li>
<li class="toctree-l2"><a class="reference internal" href="ec2unpatchedworkflow.html">EC2 - Terminate Unpatchable Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbdeleteinetfacing.html">ELB - Delete New Internet-Facing ELBs</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbgarbagecollection.html">ELB - Delete Unused Elastic Load Balancers</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslblacklist.html">ELB - SSL Blacklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="elbsslwhitelist.html">ELB - SSL Whitelist</a></li>
<li class="toctree-l2"><a class="reference internal" href="iamsetrolepolicy.html">IAM - Manage Whether A Specific IAM Policy is Attached to Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambdaerrorsnotify.html">Lambda - Notify On Lambda Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="offhours.html">Example offhours policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdsdeleteunused.html">RDS - Delete Unused Databases With No Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdspublicunencrypted.html">RDS - Terminate Unencrypted Public Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3configurenewbucket.html">S3 - Configure New Buckets Settings and Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3denypublicobjectacls.html">S3 - Block Public S3 Object ACLs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">S3 - Encryption</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enable-bucket-encryption">Enable Bucket Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remediate-existing">Remediate Existing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#remediate-incoming">Remediate Incoming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bucket-policy">Bucket Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="s3globalgrants.html">S3 - Global Grants</a></li>
<li class="toctree-l2"><a class="reference internal" href="sagemakernotebookdeletepublicorunencrypted.html">SageMaker Notebook - Delete Public or Unencrypted</a></li>
<li class="toctree-l2"><a class="reference internal" href="securitygroupsdetectremediate.html">Security Groups - Detect and Remediate Violations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tagcompliance.html">Tag Compliance Across Resources (EC2, ASG, ELB, S3, etc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcflowlog.html">VPC - Flow Log Configuration Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="vpcpeeringcrossaccount.html">VPC - Notify On Invalid External Peering Connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../aws-modes.html">AWS Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Monitoring your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lambda.html">Lambda Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">AWS Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Azure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../azure/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/authentication.html">Authentication &amp; Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/azure-modes.html">Azure Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/advanced/index.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure/resources/index.html">Azure Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">GCP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gettingstarted.html">Getting Started (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/gcp-modes.html">GCP Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/policy/index.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#adding-new-gcp-resources">Adding New GCP Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/contribute.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gcp/resources/index.html">GCP Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-org.html">c7n-org: Multi Account Custodian Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-policystream.html">c7n-policystream: Policy Changes from Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-mailer.html">c7n-mailer: Custodian Mailer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/c7n-trailcreator.html">AWS Retroactive Tagging Resource Creators</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">Contributing to Cloud Custodian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/installing.html">Installing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/tests.html">Testing for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/documentation.html">Documentation For Developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Custodian</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Example Policies</a> &raquo;</li>
        
      <li>S3 - Encryption</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="s3-encryption">
<h1>S3 - Encryption<a class="headerlink" href="#s3-encryption" title="Permalink to this headline">¶</a></h1>
<div class="section" id="enable-bucket-encryption">
<h2>Enable Bucket Encryption<a class="headerlink" href="#enable-bucket-encryption" title="Permalink to this headline">¶</a></h2>
<p>The following policy will enable bucket encryption on all s3 buckets.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-set-bucket-encryption</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">set-bucket-encryption</span>
        <span class="nt">crypto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AES256</span>
        <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="remediate-existing">
<h2>Remediate Existing<a class="headerlink" href="#remediate-existing" title="Permalink to this headline">¶</a></h2>
<p>Will scan all keys in the bucket for unencrypted keys and by default
remediate them such that they are encrypted.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-key-encryption</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">encrypt-keys</span>
        <span class="nt">crypto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws:kms</span>
</pre></div>
</div>
<div class="section" id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crypto</span></code> for determining the crypto mechanism, this can either be
<code class="docutils literal notranslate"><span class="pre">aws:kms</span></code> or <code class="docutils literal notranslate"><span class="pre">AES256</span></code> (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key-id</span></code> for specifiying the customer KMS key to use for the SSE, if the
<code class="docutils literal notranslate"><span class="pre">crypto</span></code> value passed is <code class="docutils literal notranslate"><span class="pre">aws:kms</span></code> the AWS default KMS key will be used
instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">report-only</span></code> generate reports of unencrypted keys in a bucket, but do
not remediate them.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="remediate-incoming">
<h2>Remediate Incoming<a class="headerlink" href="#remediate-incoming" title="Permalink to this headline">¶</a></h2>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">set-bucket-encryption</span></code> action is a much more effective way of
enabling encryption on a bucket.</p>
<p>Will scan all newly created objects and remediate them such that they are
encrypted.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-attach-encryption</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="nt">actions</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">attach-encrypt</span>
        <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::123456789012:role/my-role</span>
        <span class="nt">topic</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:sns::123456789012:my-topic</span>
</pre></div>
</div>
<div class="section" id="id1">
<h3>Options<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">role</span></code> for the role the encrypting Lambda should run as (not necessary if
you provide <code class="docutils literal notranslate"><span class="pre">--assume-role</span></code> on the command line).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topic</span></code> for the SNS topic to subscribe the Lambda to. If you set
<code class="docutils literal notranslate"><span class="pre">topic</span></code> to <code class="docutils literal notranslate"><span class="pre">default</span></code> then we will reuse any existing SNS topic that
specifies <code class="docutils literal notranslate"><span class="pre">s3:ObjectCreated:*</span></code>, or set one up if needed. If <code class="docutils literal notranslate"><span class="pre">topic</span></code> is
missing, then we’ll attach via a bucket notification.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="bucket-policy">
<h2>Bucket Policy<a class="headerlink" href="#bucket-policy" title="Permalink to this headline">¶</a></h2>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">set-bucket-encryption</span></code> action is a much more effective way of
enabling encryption on a bucket.</p>
<p>Adds an encryption required bucket policy and merges with extant policy
statements. Note filters should be used to avoid hitting any buckets
that are being written to by AWS services, as these do not write
encrypted and will be blocked by this policy.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">policies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3-encryption-policy</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class="nt">actions</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">encryption-policy</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="s3globalgrants.html" class="btn btn-neutral float-right" title="S3 - Global Grants" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="s3denypublicobjectacls.html" class="btn btn-neutral float-left" title="S3 - Block Public S3 Object ACLs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Capital One Services, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>